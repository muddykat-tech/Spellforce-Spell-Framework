\doxysection{sf\+\_\+spelltype\+\_\+hook.\+c}
\hypertarget{sf__spelltype__hook_8c_source}{}\label{sf__spelltype__hook_8c_source}\index{src/internal/core/hooks/sf\_spelltype\_hook.c@{src/internal/core/hooks/sf\_spelltype\_hook.c}}
\mbox{\hyperlink{sf__spelltype__hook_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sf__spelltype__registry_8h}{../../registry/sf\_spelltype\_registry.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00002}00002\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sf__wrappers_8h}{../sf\_wrappers.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00003}00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sf__hooks_8h}{../sf\_hooks.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00005}00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sf__spelltype__hook_8h}{sf\_spelltype\_hook.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00007}00007\ \textcolor{keyword}{static}\ \mbox{\hyperlink{sf__general__structures_8h_a8c9b4c8637d55a626fdb72a8f9b58922}{figure\_toolbox\_get\_unkn\_ptr}}\ s\_figure\_toolbox\_get\_unkn;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00008}00008\ \textcolor{keyword}{static}\ \mbox{\hyperlink{sf__general__structures_8h_a6694222e4b9549b92231e7afa2107b57}{get\_spell\_spell\_line\_ptr}}\ s\_get\_spell\_spell\_line;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00009}00009\ \textcolor{keyword}{static}\ \mbox{\hyperlink{sf__general__structures_8h_a777aa0a7a267165f9a196f9b293a35c4}{figure\_toolbox\_add\_spell\_ptr}}\ s\_figure\_toolbox\_add\_spell;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00011}\mbox{\hyperlink{sf__spelltype__hook_8c_a1bc35d41762c3fcc7495cf54585283aa}{00011}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sf__spelltype__hook_8c_a1bc35d41762c3fcc7495cf54585283aa}{initialize\_spelltype\_data\_hooks}}()}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00012}00012\ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00013}00013\ \ \ \ \ s\_get\_spell\_spell\_line\ =\ (\mbox{\hyperlink{sf__general__structures_8h_a6694222e4b9549b92231e7afa2107b57}{get\_spell\_spell\_line\_ptr}})(\mbox{\hyperlink{namespace_a_s_i_a05ca5acefdcb7e955f472b60e5511a1a}{ASI::AddrOf}}(0x26E100));}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00014}00014\ \ \ \ \ s\_figure\_toolbox\_get\_unkn\ =\ (\mbox{\hyperlink{sf__general__structures_8h_a8c9b4c8637d55a626fdb72a8f9b58922}{figure\_toolbox\_get\_unkn\_ptr}})(\mbox{\hyperlink{namespace_a_s_i_a05ca5acefdcb7e955f472b60e5511a1a}{ASI::AddrOf}}(0x2FE704));}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00015}00015\ \ \ \ \ s\_figure\_toolbox\_add\_spell\ =\ (\mbox{\hyperlink{sf__general__structures_8h_a777aa0a7a267165f9a196f9b293a35c4}{figure\_toolbox\_add\_spell\_ptr}})(\mbox{\hyperlink{namespace_a_s_i_a05ca5acefdcb7e955f472b60e5511a1a}{ASI::AddrOf}}(0x2F673A));}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00016}00016\ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00018}\mbox{\hyperlink{sf__spelltype__hook_8c_ab55b7421576dfd7ea00096b427741d9b}{00018}}\ uint16\_t\ \_\_thiscall\ \mbox{\hyperlink{sf__spelltype__hook_8c_ab55b7421576dfd7ea00096b427741d9b}{sf\_spelltype\_hook}}(\mbox{\hyperlink{sf__general__structures_8h_a65e220538ceb4410156fdcd2afcf91e6}{SF\_CGdSpell}}\ *\_this,\ uint16\_t\ spell\_id,\ uint16\_t\ param2,\ \mbox{\hyperlink{sf__general__structures_8h_aedd8705d0983d09965ace902f37d0e0b}{SF\_CGdTargetData}}\ *source,\ \mbox{\hyperlink{sf__general__structures_8h_aedd8705d0983d09965ace902f37d0e0b}{SF\_CGdTargetData}}\ *target,\ uint16\_t\ param5)}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00019}00019\ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00020}00020\ \ \ \ \ uint16\_t\ spell\_index;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00021}00021\ \ \ \ \ uint16\_t\ spell\_line;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00022}00022\ \ \ \ \ \textcolor{keywordflow}{if}\ (target-\/>entity\_type\ ==\ 1)}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00023}00023\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00024}00024\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!s\_figure\_toolbox\_get\_unkn(\_this-\/>SF\_CGdFigureToolBox,\ target-\/>entity\_index))}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00025}00025\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00027}00027\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00028}00028\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00030}00030\ \ \ \ \ \textcolor{comment}{//\ find\ 1st\ free\ slot\ for\ spell}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00031}00031\ \ \ \ \ \textcolor{keywordflow}{for}\ (spell\_index\ =\ 1;\ spell\_index\ <\ 799;\ ++spell\_index)}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00032}00032\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00033}00033\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_this-\/>active\_spell\_list[spell\_index].spell\_id\ ==\ 0)}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00034}00034\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00035}00035\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00036}00036\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00037}00037\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00038}00038\ \ \ \ \ \textcolor{keywordflow}{if}\ (spell\_index\ ==\ 799)}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00039}00039\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00040}00040\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sf__wrappers_8c_a825433b084e07dce191049d45ecdde2a}{log\_warning}}(\textcolor{stringliteral}{"{}Maximum\ spell\ limit\ (800)\ reached.\ Additional\ spells\ may\ not\ be\ registered."{}});}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00041}00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00042}00042\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00043}00043\ \ \ \ \ \textcolor{comment}{//\ max\_used\ spells\ update}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00044}00044\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_this-\/>max\_used\ <\ spell\_index)}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00045}00045\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00046}00046\ \ \ \ \ \ \ \ \ \_this-\/>max\_used\ =\ spell\_index;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00047}00047\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00048}00048\ }
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00049}00049\ \ \ \ \ \textcolor{comment}{//\ somewhere\ here\ is\ smth\ goes\ south}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00050}00050\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].spell\_id\ =\ spell\_id;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00051}00051\ \ \ \ \ spell\_line\ =\ s\_get\_spell\_spell\_line(\_this-\/>SF\_CGdResource,\ spell\_id);}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00052}00052\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].spell\_line\ =\ spell\_line;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00053}00053\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].source.entity\_type\ =\ source-\/>entity\_type;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00054}00054\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].source.entity\_index\ =\ source-\/>entity\_index;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00055}00055\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].source.position.X\ =\ (source-\/>position).X;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00056}00056\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].source.position.Y\ =\ (source-\/>position).Y;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00057}00057\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].target.entity\_type\ =\ target-\/>entity\_type;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00058}00058\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].target.entity\_index\ =\ target-\/>entity\_index;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00059}00059\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].target.position.X\ =\ (target-\/>position).X;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00060}00060\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].target.position.Y\ =\ (target-\/>position).Y;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00061}00061\ \ \ \ \ \_this-\/>active\_spell\_list[spell\_index].to\_do\_count\ =\ param2\ -\/\ (uint16\_t)(\_this-\/>OpaqueClass-\/>current\_step);}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00063}00063\ \ \ \ \ \mbox{\hyperlink{sf__registration__functions_8h_af76aa0d565c5ebb0b1eb50e2ed3377b3}{handler\_ptr}}\ func\ =\ \mbox{\hyperlink{sf__spelltype__registry_8cpp_af0733a266ae6b4cb44943b9e9a3a0dfa}{get\_spell\_handler}}(spell\_line);}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00064}00064\ \ \ \ \ func(\_this,\ spell\_index);}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00066}00066\ \ \ \ \ \textcolor{keywordflow}{if}\ (target-\/>entity\_type\ ==\ 1)}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00067}00067\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00068}00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (spell\_line\ !=\ 0x5A)}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00069}00069\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ s\_figure\_toolbox\_add\_spell(\_this-\/>SF\_CGdFigureToolBox,\ target-\/>entity\_index,\ spell\_index);}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00071}00071\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00072}00072\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00073}00073\ \ \ \ \ \textcolor{keywordflow}{return}\ spell\_index;}
\DoxyCodeLine{\Hypertarget{sf__spelltype__hook_8c_source_l00074}00074\ \}}

\end{DoxyCode}
